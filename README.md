This is the completed version of the lesson code and should run properly, the incomplete version is a stripped down version of this and is available here: 
https://github.com/Jakejellypie/Incomplete-Lesson-Code.